"use strict";function ownKeys(n,e){var a,r=Object.keys(n);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(n),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),r.push.apply(r,a)),r}function _objectSpread(n){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(a),!0).forEach(function(e){_defineProperty(n,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(a,e))})}return n}function _defineProperty(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}var canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),$scoreBox=document.querySelector("#playground-header .score span"),$lifeBox=document.querySelector("#playground-header .life"),$msgBox=document.querySelector("#playground-body .message"),$msgWrp=document.querySelector("#playground-body .message span"),grid={},snake={},food={},game={};grid.cellSize=25,grid.cellMargin=2,grid.maxCells=null,grid.margin=null,snake.minSpeed=2,snake.maxSpeed=10*snake.minSpeed,snake.boostingEnergy=2,snake.life=3,snake.subreset=function(){snake.speed=snake.minSpeed,snake.nextDirection={x:1,y:0},snake.direction=_objectSpread({},snake.nextDirection),snake.energy=0,snake.array=[{x:2,y:2},{x:3,y:2},{x:4,y:2}]},snake.reset=function(){snake.subreset(),snake.life=3;for(var e=0;e<snake.life;e++)$lifeBox.innerHTML+='<img src="./img/heart.svg" />'},snake.reset(),snake.head=function(){return snake.array[snake.array.length-1]},snake.inArray=function(e){for(var n=e.x,a=e.y,r=1<arguments.length&&void 0!==arguments[1]&&arguments[1],t=0;t<snake.array.length-r;t++)if(n==snake.array[t].x&&a==snake.array[t].y)return!0;return!1},snake.move=function(){snake.direction=_objectSpread({},snake.nextDirection);var e={x:snake.head().x+snake.direction.x,y:snake.head().y+snake.direction.y};snake.array.shift();var n=e.x<0;return!(n=(n=(n=(n=n||e.x>grid.maxCells.x)||e.y<0)||e.y>grid.maxCells.y)||snake.inArray(e,!0))&&(snake.array.push(e),!0)},snake.moveUp=function(){snake.nextDirection.x=0,snake.nextDirection.y=snake.direction.y||-1},snake.moveDown=function(){snake.nextDirection.x=0,snake.nextDirection.y=snake.direction.y||1},snake.moveLeft=function(){snake.nextDirection.x=snake.direction.x||-1,snake.nextDirection.y=0},snake.moveRight=function(){snake.nextDirection.x=snake.direction.x||1,snake.nextDirection.y=0},snake.grow=function(){snake.energy++,snake.array.unshift(snake.array[0])},snake.injure=function(){snake.life--,$lifeBox.removeChild($lifeBox.lastChild)},snake.draw=function(){context.save(),context.fillStyle="#fff",context.shadowBlur=10,context.shadowColor="#fff5";var r=grid.cellSize-2*grid.cellMargin;snake.array.forEach(function(e){var n=e.x,a=e.y,n=n*grid.cellSize+grid.cellMargin+grid.margin.x,a=a*grid.cellSize+grid.cellMargin+grid.margin.y;context.beginPath(),context.fillRect(n,a,r,r)}),context.restore()},food.pos={x:null,y:null},food.image=new Image,food.image.src="./img/apple.svg",food.place=function(){for(;food.pos={x:Math.round(Math.random()*grid.maxCells.x),y:Math.round(Math.random()*grid.maxCells.y)},snake.inArray(food.pos););},food.draw=function(){context.save();var e=food.pos.x*grid.cellSize+grid.margin.x,n=food.pos.y*grid.cellSize+grid.margin.y,a=grid.cellSize;context.beginPath(),context.drawImage(food.image,e,n,a,a),context.restore()},game.score=0,game.playing=!1,game.stopped=!1,game.subreset=function(){game.playing=!1,game.stopped=!1,snake.subreset(),food.place()},game.reset=function(){game.subreset(),game.score=0,snake.reset()},game.play=function(){hide($msgWrp,_detach($msgBox)),game.playing=!0,game.animate()},game.pause=function(){$msgWrp.innerHTML="Paused!",attach($msgBox),show($msgWrp),game.playing=!1},game.stop=function(){snake.injure(),game.playing=!1,game.stopped=!0,snake.life?($msgWrp.innerHTML="Crashed!",attach($msgBox),show($msgWrp),setTimeout(function(){$msgWrp.innerHTML="Press 'space' to start!",game.subreset(),game.draw()},2e3)):($msgWrp.innerHTML="Game Over! Score: "+game.score,attach($msgBox),show($msgWrp),game.stopped=!0,setTimeout(function(){$msgWrp.innerHTML="Press 'space' to start!",game.reset(),game.draw()},2e3))},game.updateScore=function(){game.score++,$scoreBox.innerHTML=game.score},game.feedSnake=function(){game.updateScore(),snake.grow(),food.place()},game.draw=function(){context.clearRect(0,0,canvas.width,canvas.height),snake.draw(),food.draw()},game.animate=function(){var e;game.playing&&(snake.move()?((e=snake.head()).x===food.pos.x&&e.y===food.pos.y&&(game.feedSnake(),snake.speed<snake.maxSpeed&&(snake.speed=parseInt(snake.energy/snake.boostingEnergy)+snake.minSpeed)),game.draw(),setTimeout(game.animate,1e3/snake.speed)):game.stop())};var initGround=function(){canvas.width=+getComputedStyle(canvas).width.replace("px",""),canvas.height=+getComputedStyle(canvas).height.replace("px",""),canvas.style.width="unset",canvas.style.height="unset",grid.maxCells={x:parseInt(canvas.width/grid.cellSize)-1,y:parseInt(canvas.height/grid.cellSize)-1},grid.margin={x:(canvas.width-grid.cellSize*(grid.maxCells.x+1))/2,y:(canvas.height-grid.cellSize*(grid.maxCells.y+1))/2},document.addEventListener("keydown",function(e){game.stopped||(" "===e.key?game.playing?game.pause():game.play():"ArrowUp"===e.key?snake.moveUp():"ArrowDown"===e.key?snake.moveDown():"ArrowLeft"===e.key?snake.moveLeft():"ArrowRight"===e.key&&snake.moveRight())}),food.place(),game.draw(),setTimeout(function(){attach($msgBox),show($msgWrp)},transTime)};